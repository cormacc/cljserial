{"version":3,"sources":["cljserial/pages/serial_terminal.cljs"],"mappings":"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","names":["props__39917__auto__","clj-props__39918__auto__","uix.core/glue-args","vec__56967","map__56970","cljs.core.nth","cljs.core/--destructure-map","cljs.core.get","f__39919__auto__","js/goog.DEBUG","temp__5804__auto__","cljserial.pages.serial-terminal/term-widget-dbfx","f__39838__auto__","*current-component*-orig-val__56975","uix.core/*current-component*","*current-component*-temp-val__56976","cljs.core/map?","js/Error","js/window","js/window.uix","js/window.uix.dev","sig__39847__auto__","js/window.uix.dev.signature!","js/window.uix.dev.register!","event-sub","tx-event-id","props","events","G__56973","cljserial.utils.dbfx/use-sub","uix.compiler.alpha/component-element","p1__56965#","cljserial.components.term/term-widget","cljs.core/seq","G__56974","cljserial.utils.dbfx/dispatch","cljserial.pages.serial-terminal/port-request-callback","vid","_e","p1__56981#","cljserial.utils.webserial.await_port","G__56983","G__56984","f__39915__auto__","cljserial.pages.serial-terminal/webserial-unsupported-message","*current-component*-orig-val__56988","*current-component*-temp-val__56989","uix.compiler.aot/>el","uix.compiler.attributes/interpret-attrs","cljserial.pages.serial-terminal/side-panel","*current-component*-orig-val__57008","*current-component*-temp-val__57009","port-context","cljserial.utils.hsm/use-sub-context","port","serial-options","js/goog.debug.LOGGING_ENABLED","lambdaisland.glogi.log","cljs.core/identity","cljserial.components.serial-port/settings","cljserial.utils.webserial/describe-port","cljs.core.partial","G__57001","k","v","G__57003","cd-info","G__57005","sd-info","uix.compiler.attributes/interpret-props","cljserial.components.cd-info/card","p1__56994#","cljserial.components.file-card/card","G__57007","cljserial.pages.serial-terminal/terminal-pane","*current-component*-orig-val__57018","*current-component*-temp-val__57019","serial-state","cljserial.utils.hsm/use-sub-state","cljserial.utils.hsm/in-state","cljserial.pages.serial-terminal/layout","*current-component*-orig-val__57020","*current-component*-temp-val__57021"],"sourcesContent":["(ns cljserial.pages.serial-terminal\n  (:require\n   [lambdaisland.glogi :as log]\n   [uix.core :refer [defui $]]\n   [cljserial.utils.dbfx :as dbfx]\n   [cljserial.utils.hsm :as hsm-dbfx]\n   [cljserial.utils.webserial :as wsu]\n   [cljserial.components.cd-info :as cd-info]\n   [cljserial.components.file-card :as file-card]\n   [cljserial.components.serial-port :as serial-port]\n   [cljserial.components.term :as term]))\n\n\n(defui term-widget-dbfx [{:keys [event-sub tx-event-id] :as props}]\n  (let [events (dbfx/use-sub [event-sub])]\n    ($ term/term-widget {:events events\n                         :on-add-event #(when (seq %)\n                                          (dbfx/dispatch [tx-event-id %]))})))\n\n(defn port-request-callback [vid _e]\n  (wsu/await-port\n   :vendor-id vid\n   :on-success #(dbfx/dispatch [:webserial-has-port %1])\n   :on-failure #(dbfx/dispatch [:webserial-no-port])))\n\n(defui webserial-unsupported-message []\n  ($ :div \"The Web Serial API is not currently available. Make sure you're running Chrome, Edge or Safari and serving this page from a secure context (i.e. over a https link or from localhost).  See Mozilla documentation for more details on \" ($ :a {:href \"https://developer.mozilla.org/en-US/docs/Web/API/Web_Serial_API#browser_compatibility\"} \"browser support\") \", and \" ($ :a {:href \"https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts\"} \"secure contexts\") \".\"))\n\n(defui side-panel []\n  ($ :.flex.flex-col\n     (let [port-context (hsm-dbfx/use-sub-context :usb-serial)\n           port (:port port-context)\n           serial-options (:serial-options port-context)]\n       (log/debug :terminal/options serial-options)\n       ($ serial-port/settings\n          {:port (if port\n                   (wsu/describe-port port)\n                   nil)\n           :options serial-options\n           :on-port-request (partial port-request-callback (:vendorIdFilter serial-options))\n           :on-port-forget #(dbfx/dispatch [:webserial-forget-port])\n           :on-option-update (fn [k v]\n                               (dbfx/dispatch [:webserial-option k v]))}))\n     (let [cd-info (dbfx/use-sub [:cd-info])\n           sd-info (:sd-card cd-info)]\n       [($ cd-info/card cd-info)\n        ($ file-card/card {:filestore sd-info :on-file-click #(dbfx/dispatch [:serial-tx (str \"file get \" %)] )})])))\n\n(defui terminal-pane []\n  ($ :.flex.flex-col\n     (let [serial-state (hsm-dbfx/use-sub-state :usb-serial)]\n       (log/debug :terminal/layout (str \"Rendering webserial hsm state \" serial-state))\n       (if (hsm-dbfx/in-state serial-state :no-webserial)\n         ($ webserial-unsupported-message)\n         ($ term-widget-dbfx {:event-sub :serial-events :tx-event-id :serial-tx})))))\n\n(defui layout []\n  ($ :.flex.flex-row.gap-1\n     ($ :.basis-80.grow-0 ($ side-panel))\n     ($ :.basis-0.grow\n        ($ terminal-pane))))\n"]}