{"version":3,"sources":["stack/demo/core.cljs"],"mappings":";AA+BA,AAACA;AACD,8BAAA,2CAAA,6DAAA,wDAAA,AAAA,8EAAA,wDAAA,AAAA,uEAAA,3YAACC;AAMD,GAAAC;AAAA,AAAA,AAAAC,qDAAA,kBAAA,qDAAA,AAAAC,mBAAA,2CAAA,wEAAA,uBAAA,oDAAA,YAAA;;AAAA;AACA,AAACC;AAKD,IAAAC,iBAAA,mFAAA;AAAA,AAAA,6HAAAA,4DAAAA,xLAACC,+DAAAA,+EAAAA;AAGD,yBAAA,mFAAA,mFAAA,IAAA,2CAAA,qDAAA,yGAAA,sDAAA,YAAA,uGAAA,mFAAA,MAAA,2CAAA,qDAAA,gGAAA,sDAAA,eAAA,oGAAA,mFAAA,SAAA,2CAAA,qDAAA,+FAAA,sDAAA,QAAA,oGAAA,mFAAA,WAAA,2CAAA,qDAAA,mGAAA,sDAAA,UAAA,0GAAA,mFAAA,QAAA,2CAAA,qDAAA,iFAAA,sDAAA,UAAA,iGAAA,mFAAA,WAAA,2CAAA,qDAAA,wFAAA,sDAAA,YAAA,poFAAKC,mgBAIMC,qcAKAC,6bAKAC,qcAKAC,sbAKAC,ybAKAC;AAGX,gCAAA,hCAAMC;AAAN,AAIE,yBAAA,zBAACC;;AAID,AAACC;;AAGD,AAACC;;AAGD,OAACC;;AAOH,uBAAA,vBAAeC;AAAf,AAEE,AAACL;;AAaD,GAAAb;AAAA,AAAA,AAAAC,qDAAA,kBAAA,qDAAA,AAAAC,mBAAA,2CAAA,yDAAA,aAAA,oDAAA,aAAA;;AAAA;;AAOA,uCAAA,2CAAA,+EAAA,1JAACiB,mIAAwBb,iFAAec","names":["lambdaisland.glogi.console/install!","lambdaisland.glogi/set-levels","js/goog.debug.LOGGING_ENABLED","lambdaisland.glogi.log","cljs.core/identity","cljs.core/enable-console-print!","G__88761","stack.utils.dbfx/dispatch-sync","stack.demo.core/routes","connect.pages.mbt-terminal/layout","stack.pages.bt-terminal/layout","stack.pages.domain-data/layout","stack.pages.backend/layout-with-auth","stack.pages.todo-mvc/layout","stack.pages.converter/layout","stack.demo.core/init-services","stack.services.auth/init","stack.services.webserial/init","stack.services.bt/init","connect.services.mbt-cd/init","stack.demo.core/init","stack.utils.router/render!","connect.layout/app-layout"],"sourcesContent":["(ns stack.demo.core\n  (:require\n   [lambdaisland.glogi :as log]\n   [lambdaisland.glogi.console :as glogi-console]\n   [stack.utils.dbfx :refer [dispatch-sync]]\n   [stack.utils.router :as router]\n   ;; AWS integration bypassed for now\n   ;; [stack.utils.aws :as aws]\n   ;; Models ...\n   [connect.models.view]\n   [connect.models.domain]\n   ;; Services ...\n   [stack.services.auth]\n   [stack.services.bt]\n   [stack.services.webserial]\n   [connect.services.mbt-cd]\n   ;; UI ...\n   [connect.layout :refer [app-layout]]\n   [connect.pages.mbt-terminal :as serial-terminal]\n   ;; [stack.pages.serial-terminal :as serial-terminal]\n   [stack.pages.bt-terminal :as bt-terminal]\n   [stack.pages.todo-mvc :as todo]\n   [stack.pages.converter :as converter]\n   [stack.pages.backend :as backend]\n   [stack.pages.domain-data :as domain-data]\n   ;; DEV tools\n   ;; ... TODO: Move to a new module in dev/ tree? or do configuration based init\n   [cljs-react-devtools.core]))\n\n;; -- Logging ----------------------------------------------------------\n;; See https://github.com/lambdaisland/glogi\n(glogi-console/install!)\n(log/set-levels\n {:glogi/root   :debug    ;; Set a root logger level, this will be inherited by all loggers\n  'stack.utils.hsm :debug   ;; Some namespaces you might want detailed logging\n  'my.app.other :error   ;; or for others you only want to see errors.\n  })\n\n(log/info :startup/logging \"Logging initialised!\")\n(enable-console-print!)   ;; so that println writes to `console.log`\n\n;; -- Initialise refx application database ------------------------------------\n;; The event handler for `:initialise-db` can be found in `model.cljs`\n;; Using the sync version of dispatch means that value is in place before we go onto the next step.\n(dispatch-sync [:initialise-db])\n\n;; -- Setup routes ------------------------------------\n(def routes\n  [[\"/\"\n    {:name ::serial-terminal\n     :title \"WebSerial\"\n     :view serial-terminal/layout}]\n\n   [\"/bt\"\n    {:name ::bt-terminal\n     :title \"WebBluetooth\"\n     :view bt-terminal/layout}]\n\n   [\"/local\"\n    {:name ::local-data\n     :title \"Local\"\n     :view domain-data/layout}]\n\n   [\"/backend\"\n    {:name ::backend-demo\n     :title \"Backend\"\n     :view backend/layout-with-auth}]\n\n   [\"/todo\"\n    {:name ::todo\n     :title \"TodoMVC\"\n     :view todo/layout}]\n\n   [\"/convert\"\n    {:name ::convert\n     :title \"HTML->UIx\"\n     :view converter/layout}]])\n\n\n(defn init-services []\n\n  ;; User signup and auth service - currently provided via a supabase backend.\n  ;; Pass 'false' to disable backend and spoof an active session\n  (stack.services.auth/init true)\n\n  ;; The WebSerial service is implemented as a heirarchical state machine\n  ;; Can be used for a simple terminal, or as a basis for services using a command parser\n  (stack.services.webserial/init)\n\n  ;; WebBluetooth service (this does nothing yet)\n  (stack.services.bt/init)\n\n  ;; MBT CD service - implements command/response parsing on top of the webserial service\n  (connect.services.mbt-cd/init))\n\n;; -- Wrap UIx layout in AWS Amplify auth --------------\n;; (defn aws-auth-wrap [uix-layout]\n;;   (withAuthenticator (uix/as-react uix-layout)))\n\n;; -- Initialise UI ------------------------------------\n(defn ^:export init []\n\n  (init-services)\n\n;;Bypassed initialisation for https://github.com/roman01la/cljs-react-devtools\n  ;;Hotkey activation not working on initial attempt, and may conflict with re-frame-10x\n  ;; (log/info :uix-devtools \"Initialising\")\n  ;; (cljs-react-devtools.core/init!\n  ;;  {:root (js/document.getElementById \"root\")\n  ;;   :shortcut \"Control-Alt-r\"})\n\n;; AWS integration bypassed for now\n  ;; (aws/configure)\n  ;; (router/render! {:routes routes :layout (aws/with-authenticator app-layout)})\n\n  (log/info :router \"Rendering!\")\n\n  ;; Wrap the entire UI in auth\n  ;; (router/render! {:routes routes :layout app-layout\n  ;;                  :wrapper stack.services.auth/wrap-layout ;;                  })\n\n  ;; ... or let auth stay in backend page, but retain sign-out link in appbar\n  (router/render! {:routes routes :layout app-layout})\n;;\n  )\n"]}