{
"version":3,
"file":"promesa.impl.promise.js",
"lineCount":331,
"mappings":"AAEAA,IAAKC,CAAAA,OAAL,CAAa,sBAAb,CAAA;AACAD,IAAKC,CAAAA,OAAL,CAAa,kCAAb,CAAA;AACAD,IAAKC,CAAAA,OAAL,CAAa,wCAAb,CAAA;AAEAD,IAAKE,CAAAA,KAAL,CAAW,QAAQ,EAAG;AAkMpBC,UAASA,oBAAmB,CAACC,CAAD,CAAI;AAC9B,WAAOA,CAAP,YAAoBC,iBAApB;AAD8B;AAIhCC,UAASA,SAAS,CAACC,CAAD,CAAI;AACpB,QAAIC,UAAA,CAAWD,CAAX,CAAJ;AACE,aAAQ,YAAWP,IAAKS,CAAAA,MAAL,CAAYF,CAAZ,CAAX,GAAR;AADF,UAEO,KAAIA,CAAJ,YAAiBG,KAAjB;AACL,aAAQ,eAAcH,CAAEI,CAAAA,OAAhB,IAAR;AADK,UAEA,KAAIJ,CAAJ,KAAU,IAAV,IAAkBA,CAAlB,KAAwBK,SAAxB;AACL,aAAQ,GAAEL,CAAF,EAAR;AADK,UAEA,KAAI,MAAOA,EAAX,KAAiB,UAAjB;AACL,aAAQ,OAAMP,IAAKS,CAAAA,MAAL,CAAYF,CAAZ,CAAN,GAAR;AADK;AAGL,aAAQ,GAAEA,CAAEM,CAAAA,QAAF,EAAF,EAAR;AAHK;AAPa;AActBC,UAASA,OAAM,CAACP,CAAD,CAAI;AACjB,WAAOA,CAAP,KAAa,IAAb,IAAqBA,CAArB,KAA2BK,SAA3B;AADiB;AAInBG,UAASA,WAAW,CAACR,CAAD,CAAI;AACtB,WAAO,MAAOA,EAAd,KAAoB,UAApB;AADsB;AAIxBC,UAASA,WAAW,CAACD,CAAD,CAAI;AACtB,QAAIP,IAAKgB,CAAAA,QAAL,CAAcT,CAAd,CAAJ,CAAsB;AACpB,YAAMU,SAASV,CAAEW,CAAAA,IAAjB;AACA,aAAOH,UAAA,CAAWE,MAAX,CAAP;AAFoB,KAAtB;AAIE,aAAO,KAAP;AAJF;AADsB;AASxBE,UAASA,WAAU,CAACf,CAAD,CAAI;AACrB,WAAO,EAAA,IAAMA;AAAAA,aAAAA,CAAAA;AAAAA,KAAb;AADqB;AAIvBgB,UAASA,SAAS,CAAChB,CAAD,CAAI;AACpB,WAAOA,CAAP;AADoB;AAItBiB,UAASA,cAAc,CAACjB,CAAD,CAAI;AACzB,WAAOA,CAAP,YAAoBkB,WAApB;AADyB;AAI3BC,UAASA,mBAAkB,CAACC,QAAD,CAAW;AACpC,WAAO,CAACC,KAAD,EAAQC,KAAR,CAAA,IAAkB;AACvB,UAAIA,KAAJ;AACEF,gBAASG,CAAAA,MAAT,CAAgBD,KAAhB,CAAA;AADF;AAGEF,gBAASI,CAAAA,OAAT,CAAiBH,KAAjB,CAAA;AAHF;AADuB,KAAzB;AADoC;AAUtCI,UAASA,QAAO,CAACC,CAAD,CAAI;AAClB,QAAIA,CAAA,CAAEC,KAAF,CAAJ,KAAiBC,OAAjB;AAA0B;AAA1B;AACAC,YAAA,CAASC,eAAT,EAA0BJ,CAA1B,CAAA;AACA,WAAOA,CAAP;AAHkB;AAMpBI,UAASA,gBAAe,CAACJ,CAAD,CAAI;AAC1B,QAAIA,CAAA,CAAEK,KAAF,CAASC,CAAAA,MAAb,KAAwB,CAAxB;AAA2B;AAA3B;AAEA,UAAMC,QAAQP,CAAA,CAAEC,KAAF,CAAd;AACA,UAAMN,QAAQK,CAAA,CAAEQ,KAAF,CAAd;AAJ0B,QAKtBC,IALsB;AAAA,QAKhBC,MALgB;AAK1B,QAAkBC,MAAlB;AAQA,SAAA,EAAOX,CAAA,CAAEK,KAAF,CAASC,CAAAA,MAAhB,CAAA,CAAwB;AACtBG,UAAA,GAAOT,CAAA,CAAEK,KAAF,CAASO,CAAAA,KAAT,EAAP;AAMA,SAAI;AACF,YAAIL,KAAJ,KAAcM,QAAd;AACEH,gBAAA,GAASD,IAAKX,CAAAA,OAAL,CAAaH,KAAb,CAAT;AADF,cAEO,KAAIY,KAAJ,KAAcO,QAAd;AACLJ,gBAAA,GAASD,IAAKZ,CAAAA,MAAL,CAAYF,KAAZ,CAAT;AADK;AAGLgB,gBAAA,GAAS,IAAII,SAAJ,CAAc,eAAd,CAAT;AAHK;AAHL,OAQF,QAAOC,CAAP,CAAU;AACVL,cAAA,GAASK,CAAT;AADU;AAIZC,iBAAA,CAAYR,IAAZ,EAAkBC,MAAlB,EAA0BC,MAA1B,CAAA;AAnBsB;AAbE;AAoC5BM,UAASA,YAAW,CAACR,IAAD,EAAOd,KAAP,EAAcC,KAAd,CAAqB;AAEvC,QAAIa,IAAKS,CAAAA,QAAT,KAAsBpC,SAAtB;AAAiC;AAAjC;AAEA,QAAIc,KAAJ;AACEa,UAAKS,CAAAA,QAAL,CAAc,IAAd,EAAoBtB,KAApB,CAAA;AADF;AAGE,UAAIa,IAAKU,CAAAA,IAAT,KAAkBC,gBAAlB;AAEEX,YAAKS,CAAAA,QAAL,CAAcvB,KAAd,EAAqB,IAArB,CAAA;AAFF,YAGO,KAAIc,IAAKU,CAAAA,IAAT,KAAkBE,oBAAlB;AACL,YAAI9B,aAAA,CAAcI,KAAd,CAAJ;AACEA,eAAM2B,CAAAA,MAAN,CAAa,CAAChD,CAAD,EAAIiD,CAAJ,CAAA,IAAU;AACrBN,uBAAA,CAAYR,IAAZ,EAAkBnC,CAAlB,EAAqBiD,CAArB,CAAA;AADqB,WAAvB,CAAA;AADF,cAIO,KAAI7C,UAAA,CAAWiB,KAAX,CAAJ;AACLA,eAAMP,CAAAA,IAAN,CAAYd,CAAD,IAAO;AAChB2C,uBAAA,CAAYR,IAAZ,EAAkBnC,CAAlB,EAAqB,IAArB,CAAA;AADgB,WAAlB,EAEIiD,CAAD,IAAO;AACRN,uBAAA,CAAYR,IAAZ,EAAkB,IAAlB,EAAwBc,CAAxB,CAAA;AADQ,WAFV,CAAA;AADK;AAOLd,cAAKS,CAAAA,QAAL,CAAcvB,KAAd,EAAqB,IAArB,CAAA;AAPK;AALF,YAcA,KAAIc,IAAKU,CAAAA,IAAT,KAAkBK,iBAAlB;AACL,YAAIjC,aAAA,CAAcI,KAAd,CAAJ;AACEA,eAAM2B,CAAAA,MAAN,CAAa,CAAChD,CAAD,EAAIiD,CAAJ,CAAA,IAAU;AACrBd,gBAAKS,CAAAA,QAAL,CAAc5C,CAAd,EAAiBiD,CAAjB,CAAA;AADqB,WAAvB,CAAA;AADF,cAIO,KAAI7C,UAAA,CAAWiB,KAAX,CAAJ;AACLA,eAAMP,CAAAA,IAAN,CAAYd,CAAD,IAAO;AAChBmC,gBAAKS,CAAAA,QAAL,CAAc5C,CAAd,EAAiB,IAAjB,CAAA;AADgB,WAAlB,EAEIiD,CAAD,IAAO;AACRd,gBAAKS,CAAAA,QAAL,CAAc,IAAd,EAAoBK,CAApB,CAAA;AADQ,WAFV,CAAA;AADK;AAOLd,cAAKS,CAAAA,QAAL,CAAc,IAAd,EAAoB,IAAIH,SAAJ,CAAc,mBAAd,CAApB,CAAA;AAPK;AALF;AAeLN,YAAKS,CAAAA,QAAL,CAAc,IAAd,EAAoB,IAAIH,SAAJ,CAAc,gCAAd,CAApB,CAAA;AAfK;AApBT;AAJuC;AA4CzCU,UAASA,WAAU,CAACzB,CAAD,EAAIO,KAAJ,EAAWZ,KAAX,CAAkB;AAQnC,QAAIK,CAAA,CAAEC,KAAF,CAAJ,KAAiBM,KAAjB,IACIP,CAAA,CAAEC,KAAF,CADJ,KACiBC,OADjB;AAEE;AAFF;AAKAF,KAAA,CAAEC,KAAF,CAAA,GAAWM,KAAX;AACAP,KAAA,CAAEQ,KAAF,CAAA,GAAWb,KAAX;AAEA,WAAOS,eAAA,CAAgBJ,CAAhB,CAAP;AAhBmC;AAhVrC,QAAM0B,OAAOC,OAAQC,CAAAA,IAAKC,CAAAA,OAA1B;AACA,QAAMC,OAAO5D,IAAK6D,CAAAA,MAAlB;AAEA,QAAM7B,UAAU8B,MAAA,CAAO,eAAP,CAAhB;AACA,QAAMnB,WAAWmB,MAAA,CAAO,gBAAP,CAAjB;AACA,QAAMlB,WAAWkB,MAAA,CAAO,gBAAP,CAAjB;AAEA,QAAM3B,QAAQ2B,MAAA,CAAO,OAAP,CAAd;AACA,QAAM/B,QAAQ+B,MAAA,CAAO,OAAP,CAAd;AACA,QAAMxB,QAAQwB,MAAA,CAAO,OAAP,CAAd;AAEA,QAAMX,uBAAuBW,MAAA,CAAO,sBAAP,CAA7B;AACA,QAAMR,oBAAoBQ,MAAA,CAAO,mBAAP,CAA1B;AACA,QAAMZ,mBAAmBY,MAAA,CAAO,kBAAP,CAAzB;AAEA,QAAMC,2BAA4B3D,CAAD2D,IAAO3D;AAAAA,WAAAA,CAAAA;AAAAA,GAAxC;AACA,QAAM4D,4BAA6B5D,CAAD4D,IAAO;AAAA,WAAAR,IAAKS,CAAAA,QAAL,CAAc7D,CAAd,CAAA;AAAA,GAAzC;AACA,QAAM8D,uBAAwBb,CAADa,IAAO;AAAC,UAAMb,CAAN;AAAD,GAApC;AAEA,OAAMhD,kBAAN,QAAgCK,MAAhC;;AAEA,OAAMY,YAAN;AACE6C,eAAY,CAACC,GAAD,CAAM;AAChB,UAAA,CAAKjC,KAAL,CAAA,GAAc,EAAd;AACA,UAAA,CAAKJ,KAAL,CAAA,GAAcC,OAAd;AACA,UAAA,CAAKM,KAAL,CAAA,GAAc1B,SAAd;AAEA,UAAIwD,GAAJ,KAAYxD,SAAZ;AACE2C,kBAAA,CAAW,IAAX,EAAiBZ,QAAjB,EAA2ByB,GAA3B,CAAA;AADF;AALgB;AAUd,aAAS,EAAA;AACX,aAAO,IAAA,CAAKrC,KAAL,CAAP;AADW;AAIT,aAAS,EAAA;AACX,aAAO,IAAA,CAAKO,KAAL,CAAP;AADW;AAIbpB,QAAK,CAACU,OAAD,EAAUD,MAAV,CAAkB;AACrB,YAAMH,WAAW,IAAIF,WAAJ,EAAjB;AAEA,UAAA,CAAKa,KAAL,CAAYkC,CAAAA,IAAZ,CAAiB,CACfpB,KAAME,oBADS,EAEfvB,QAASA,OAATA,IAAoBmC,wBAFL,EAGfpC,OAAQA,MAARA,IAAkBuC,oBAHH,EAIflB,SAAUzB,kBAAA,CAAmBC,QAAnB,CAJK,CAAjB,CAAA;AAaAK,aAAA,CAAQ,IAAR,CAAA;AACA,aAAOL,QAAP;AAjBqB;AAoBvB8C,SAAM,CAAC3C,MAAD,CAAS;AACb,aAAO,IAAKT,CAAAA,IAAL,CAAU,IAAV,EAAgBS,MAAhB,CAAP;AADa;AAIf4C,WAAQ,CAACC,CAAD,CAAI;AACV,UAAA,CAAKrC,KAAL,CAAYkC,CAAAA,IAAZ,CAAiB,CACfpB,KAAME,oBADS,EAEfvB,QAAUH,KAADG,IAAW;AAAA,eAAA4C,CAAA,EAAA;AAAA,OAFL,EAGf7C,OAASD,KAADC,IAAW;AAAA,eAAA6C,CAAA,EAAA;AAAA,OAHJ,EAIfxB,SAAU,CAACvB,KAAD,EAAQC,KAAR,CAAAsB,IAAkB;AAAA,eAAA,IAAA;AAAA,OAJb,CAAjB,CAAA;AAOA,aAAO,IAAP;AARU;AAWZyB,QAAK,CAAC7C,OAAD,EAAUD,MAAV,CAAkB;AACrB,YAAMH,WAAW,IAAIF,WAAJ,EAAjB;AAEA,UAAA,CAAKa,KAAL,CAAYkC,CAAAA,IAAZ,CAAiB,CACfpB,KAAMC,gBADS,EAEftB,QAASA,OAATA,IAAoBmC,wBAFL,EAGfpC,OAAQA,MAARA,IAAkBuC,oBAHH,EAIflB,SAAUzB,kBAAA,CAAmBC,QAAnB,CAJK,CAAjB,CAAA;AAaAK,aAAA,CAAQ,IAAR,CAAA;AACA,aAAOL,QAAP;AAjBqB;AAoBvBkD,SAAM,CAAC9C,OAAD,EAAUD,MAAV,CAAkB;AACtB,YAAMH,WAAW,IAAIF,WAAJ,EAAjB;AAEA,UAAA,CAAKa,KAAL,CAAYkC,CAAAA,IAAZ,CAAiB,CACfpB,KAAMK,iBADS,EAEf1B,QAASA,OAATA,IAAoBoC,yBAFL,EAGfrC,OAAQA,MAARA,IAAkBuC,oBAHH,EAIflB,SAAUzB,kBAAA,CAAmBC,QAAnB,CAJK,CAAjB,CAAA;AAaAK,aAAA,CAAQ,IAAR,CAAA;AACA,aAAOL,QAAP;AAjBsB;AAoBxB4B,UAAO,CAACuB,EAAD,EAAKC,WAAL,CAAkB;AACvBA,iBAAA,GAAcA,WAAd,IAA6B1B,gBAA7B;AAEA,UAAA,CAAKf,KAAL,CAAYkC,CAAAA,IAAZ,CAAiB,CACfpB,KAAM2B,WADS,EAEfhD,QAASmC,wBAFM,EAGfpC,OAAQuC,oBAHO,EAIflB,SAAU2B,EAJK,CAAjB,CAAA;AAOA9C,aAAA,CAAQ,IAAR,CAAA;AAVuB;AAezBD,WAAO,CAACH,KAAD,CAAQ;AACb,UAAI,IAAA,CAAKM,KAAL,CAAJ,KAAoBC,OAApB;AAKEuB,kBAAA,CAAW,IAAX,EAAiBZ,QAAjB,EAA2BlB,KAA3B,CAAA;AALF;AAOA,aAAO,IAAP;AARa;AAWfE,UAAM,CAACD,KAAD,CAAQ;AACZ,UAAI,IAAA,CAAKK,KAAL,CAAJ,KAAoBC,OAApB;AAIEuB,kBAAA,CAAW,IAAX,EAAiBX,QAAjB,EAA2BlB,KAA3B,CAAA;AAJF;AAMA,aAAO,IAAP;AAPY;AAUdmD,aAAS,EAAG;AACV,YAAMxC,QAAQ,IAAA,CAAKN,KAAL,CAAd;AACA,aAAOM,KAAP,KAAiBL,OAAjB;AAFU;AAKZ8C,cAAU,EAAG;AACX,YAAMzC,QAAQ,IAAA,CAAKN,KAAL,CAAd;AACA,aAAOM,KAAP,KAAiBM,QAAjB;AAFW;AAKboC,cAAU,EAAG;AACX,YAAM1C,QAAQ,IAAA,CAAKN,KAAL,CAAd;AACA,aAAOM,KAAP,KAAiBO,QAAjB;AAFW;AAKboC,eAAW,EAAG;AACZ,YAAM3C,QAAQ,IAAA,CAAKN,KAAL,CAAd;AACA,YAAMN,QAAQ,IAAA,CAAKa,KAAL,CAAd;AACA,aAAQD,KAAR,KAAkBO,QAAlB,IAA8BzC,mBAAA,CAAoBsB,KAApB,CAA9B;AAHY;AAMdwD,UAAM,EAAG;AACP,UAAKtD,CAAAA,MAAL,CAAY,IAAItB,iBAAJ,CAAsB,mBAAtB,CAAZ,CAAA;AADO;AAvJX;AA4JA,QAAM4B,WAAY,CAAA,EAAA,IAAM;AACtB,QAAI,MAAO2B,KAAKsB,CAAAA,OAAhB,KAA4B,UAA5B,CAAwC;AACtC,YAAMjB,WAAWiB,OAAQtD,CAAAA,OAAR,CAAgB,IAAhB,CAAjB;AACA,aAAOuD,QAASA,0BAAyB,CAACX,CAAD,EAAI1C,CAAJ,CAAO;AAC9CmC,gBAAS/C,CAAAA,IAAT,CAAc,EAAA,IAAM;AAAA,iBAAAsD,CAAA,CAAE1C,CAAF,CAAA;AAAA,SAApB,CAAA;AAD8C,OAAhD;AAFsC,KAAxC,KAKO,KAAI,MAAO8B,KAAKwB,CAAAA,YAAhB,KAAiC,UAAjC;AACL,aAAOxB,IAAKwB,CAAAA,YAAZ;AADK,UAEA,KAAI,MAAOxB,KAAKyB,CAAAA,UAAhB,KAA+B,UAA/B;AACL,aAAO,CAACb,CAAD,EAAI1C,CAAJ,CAAA,IAAU;AAAA,eAAA8B,IAAKyB,CAAAA,UAAL,CAAgBb,CAAhB,EAAmB,CAAnB,EAAsB1C,CAAtB,CAAA;AAAA,OAAjB;AADK;AAIL,aAAO,CAAC0C,CAAD,EAAI1C,CAAJ,CAAA,IAAU;AAAA,eAAA0C,CAAEc,CAAAA,IAAF,CAAO,IAAP,EAAaxD,CAAb,CAAA;AAAA,OAAjB;AAJK;AARe,GAAN,CAAD,EAAjB;AAkLA0B,MAAKlC,CAAAA,WAAL,GAAmBA,WAAnB;AACAkC,MAAKnD,CAAAA,iBAAL,GAAyBA,iBAAzB;AACAmD,MAAKrD,CAAAA,mBAAL,GAA2BA,mBAA3B;AAEAqD,MAAKhC,CAAAA,QAAL,GAAgB,EAAA+D,IAAM;AACpB,WAAO,IAAIjE,WAAJ,EAAP;AADoB,GAAtB;AAIA,QAAMkE,eAAe,IAAIlE,WAAJ,CAAgB,IAAhB,CAArB;AAEAkC,MAAKS,CAAAA,QAAL,GAAgBwB,QAASxB,SAAS,CAACxC,KAAD,CAAQ;AACxC,QAAIA,KAAJ,KAAc,IAAd;AACE,aAAO+D,YAAP;AADF,UAEO;AACL,YAAM1D,IAAI,IAAIR,WAAJ,EAAV;AACAQ,OAAA,CAAEC,KAAF,CAAA,GAAWY,QAAX;AACAb,OAAA,CAAEQ,KAAF,CAAA,GAAWb,KAAX;AAGA,aAAOK,CAAP;AANK;AAHiC,GAA1C;AAaA0B,MAAKkC,CAAAA,QAAL,GAAgBC,QAASD,SAAS,CAACE,MAAD,CAAS;AACzC,UAAM9D,IAAI,IAAIR,WAAJ,EAAV;AACAQ,KAAA,CAAEC,KAAF,CAAA,GAAWa,QAAX;AACAd,KAAA,CAAEQ,KAAF,CAAA,GAAWsD,MAAX;AAIA,WAAO9D,CAAP;AAPyC,GAA3C;AAUA0B,MAAKqC,CAAAA,GAAL,GAAWC,QAASD,IAAI,CAACE,QAAD,CAAW;AACjC,WAAOA,QAASC,CAAAA,MAAT,CAAgB,CAACC,GAAD,EAAMnE,CAAN,CAAA,IAAY;AACjC,aAAOmE,GAAI/E,CAAAA,IAAJ,CAAUgF,OAAD,IAAa;AAC3B,eAAO1C,IAAK2C,CAAAA,MAAL,CAAYrE,CAAZ,CAAe2C,CAAAA,IAAf,CAAqBrE,CAAD,IAAO;AAChC8F,iBAAQ7B,CAAAA,IAAR,CAAajE,CAAb,CAAA;AACA,iBAAO8F,OAAP;AAFgC,SAA3B,CAAP;AAD2B,OAAtB,CAAP;AADiC,KAA5B,EAOJ1C,IAAKS,CAAAA,QAAL,CAAc,EAAd,CAPI,CAAP;AADiC,GAAnC;AAWAT,MAAK2C,CAAAA,MAAL,GAAcC,QAASD,OAAO,CAACxC,OAAD,CAAU;AACtC,QAAIA,OAAJ,YAAuBrC,WAAvB;AACE,aAAOqC,OAAP;AADF,UAEO,KAAInD,UAAA,CAAWmD,OAAX,CAAJ,CAAyB;AAC9B,YAAMnC,WAAWgC,IAAKhC,CAAAA,QAAL,EAAjB;AACAmC,aAAQzC,CAAAA,IAAR,CAAcd,CAAD,IAAO;AAClBoB,gBAASI,CAAAA,OAAT,CAAiBxB,CAAjB,CAAA;AADkB,OAApB,EAEIiD,CAAD,IAAO;AACR7B,gBAASG,CAAAA,MAAT,CAAgB0B,CAAhB,CAAA;AADQ,OAFV,CAAA;AAKA,aAAO7B,QAAP;AAP8B,KAAzB,KAQA,KAAImC,OAAJ,YAAuBjD,KAAvB;AACL,aAAO8C,IAAKkC,CAAAA,QAAL,CAAc/B,OAAd,CAAP;AADK;AAGL,aAAOH,IAAKS,CAAAA,QAAL,CAAcN,OAAd,CAAP;AAHK;AAX+B,GAAxC;AAkBAH,MAAK6C,CAAAA,IAAL,GAAYC,QAASD,KAAK,CAACN,QAAD,CAAW;AACnC,UAAMvE,WAAWgC,IAAKhC,CAAAA,QAAL,EAAjB;AAEAuE,YAASQ,CAAAA,OAAT,CAAkBzE,CAAD,IAAO;AACtB0B,UAAK2C,CAAAA,MAAL,CAAYrE,CAAZ,CAAesB,CAAAA,MAAf,CAAsB,CAAChD,CAAD,EAAIiD,CAAJ,CAAA,IAAU;AAC9B,YAAIA,CAAJ;AACE7B,kBAASG,CAAAA,MAAT,CAAgB0B,CAAhB,CAAA;AADF;AAGE7B,kBAASI,CAAAA,OAAT,CAAiBxB,CAAjB,CAAA;AAHF;AAD8B,OAAhC,CAAA;AADsB,KAAxB,CAAA;AAUA,WAAOoB,QAAP;AAbmC,GAArC;AAgBAgC,MAAKvB,CAAAA,QAAL,GAAgBA,QAAhB;AAEAuB,MAAKxB,CAAAA,OAAL,GAAeA,OAAf;AACAwB,MAAKb,CAAAA,QAAL,GAAgBA,QAAhB;AACAa,MAAKZ,CAAAA,QAAL,GAAgBA,QAAhB;AAtboB,CAAtB,CAAA;;",
"sources":["promesa/impl/promise.js"],
"sourcesContent":["\"use strict\";\n\ngoog.provide(\"promesa.impl.promise\");\ngoog.provide(\"promesa.impl.promise.PromiseImpl\");\ngoog.provide(\"promesa.impl.promise.CancellationError\");\n\ngoog.scope(function() {\n  const self = promesa.impl.promise;\n  const root = goog.global;\n\n  const PENDING = Symbol(\"state/pending\");\n  const RESOLVED = Symbol(\"state/resolved\");\n  const REJECTED = Symbol(\"state/rejected\");\n\n  const QUEUE = Symbol(\"queue\");\n  const STATE = Symbol(\"state\");\n  const VALUE = Symbol(\"value\");\n\n  const RESOLVE_TYPE_FLATTEN = Symbol(\"resolve-type/flatten\");\n  const RESOLVE_TYPE_BIND = Symbol(\"resolve-type/bind\");\n  const RESOLVE_TYPE_MAP = Symbol(\"resolve-type/map\");\n\n  const defaultResolveMapHandler = (v) => v;\n  const defaultResolveBindHandler = (v) => self.resolved(v);\n  const defaultRejectHandler = (c) => {throw c;};\n\n  class CancellationError extends Error {}\n\n  class PromiseImpl {\n    constructor (val) {\n      this[QUEUE] = [];\n      this[STATE] = PENDING;\n      this[VALUE] = undefined;\n\n      if (val !== undefined) {\n        transition(this, RESOLVED, val);\n      }\n    }\n\n    get state () {\n      return this[STATE];\n    }\n\n    get value () {\n      return this[VALUE];\n    }\n\n    then (resolve, reject) {\n      const deferred = new PromiseImpl();\n\n      this[QUEUE].push({\n        type: RESOLVE_TYPE_FLATTEN,\n        resolve: resolve ?? defaultResolveMapHandler,\n        reject: reject ?? defaultRejectHandler,\n        complete: completeDeferredFn(deferred)\n      });\n\n      // console.log(\"then\",\n      //             \"uid:\", goog.getUid(this),\n      //             \"return-uid:\", goog.getUid(deferred),\n      //             \"state:\", this[STATE],\n      //             \"value:\", fmtValue(this[VALUE]));\n\n      process(this);\n      return deferred;\n    }\n\n    catch (reject) {\n      return this.then(null, reject);\n    }\n\n    finally (f) {\n      this[QUEUE].push({\n        type: RESOLVE_TYPE_FLATTEN,\n        resolve: (value) => f(),\n        reject: (cause) => f(),\n        complete: (value, cause) => null\n      });\n\n      return this;\n    }\n\n    fmap (resolve, reject) {\n      const deferred = new PromiseImpl();\n\n      this[QUEUE].push({\n        type: RESOLVE_TYPE_MAP,\n        resolve: resolve ?? defaultResolveMapHandler,\n        reject: reject ?? defaultRejectHandler,\n        complete: completeDeferredFn(deferred)\n      });\n\n      // console.log(\"fmap\",\n      //             \"uid:\", goog.getUid(this),\n      //             \"return-uid:\", goog.getUid(deferred),\n      //             \"state:\", this[STATE],\n      //             \"value:\", fmtValue(this[VALUE]));\n\n      process(this);\n      return deferred;\n    }\n\n    fbind (resolve, reject) {\n      const deferred = new PromiseImpl();\n\n      this[QUEUE].push({\n        type: RESOLVE_TYPE_BIND,\n        resolve: resolve ?? defaultResolveBindHandler,\n        reject: reject ?? defaultRejectHandler,\n        complete: completeDeferredFn(deferred)\n      });\n\n      // console.log(\"fbind\",\n      //             \"uid:\", goog.getUid(this),\n      //             \"return-uid:\", goog.getUid(deferred),\n      //             \"state:\", this[STATE],\n      //             \"value:\", fmtValue(this[VALUE]));\n\n      process(this);\n      return deferred;\n    }\n\n    handle (fn, resolveType) {\n      resolveType = resolveType ?? RESOLVE_TYPE_MAP;\n\n      this[QUEUE].push({\n        type: resolveType,\n        resolve: defaultResolveMapHandler,\n        reject: defaultRejectHandler,\n        complete: fn\n      });\n\n      process(this);\n    }\n\n    // Deferred Methods\n\n    resolve(value) {\n      if (this[STATE] === PENDING) {\n        // console.log(\":: [deferred:resolve]\",\n        //             \"uid:\", goog.getUid(this),\n        //             \"value:\", fmtValue(value));\n\n        transition(this, RESOLVED, value);\n      }\n      return null;\n    }\n\n    reject(cause) {\n      if (this[STATE] === PENDING) {\n        // console.log(\":: [deferred:reject]\",\n        //             \"uid:\", goog.getUid(this),\n        //             \"value:\", fmtValue(cause));\n        transition(this, REJECTED, cause);\n      }\n      return null;\n    }\n\n    isPending() {\n      const state = this[STATE];\n      return state === PENDING;\n    }\n\n    isResolved() {\n      const state = this[STATE];\n      return state === RESOLVED;\n    }\n\n    isRejected() {\n      const state = this[STATE];\n      return state === REJECTED;\n    }\n\n    isCancelled() {\n      const state = this[STATE];\n      const value = this[VALUE];\n      return (state === REJECTED && isCancellationError(value));\n    }\n\n    cancel() {\n      this.reject(new CancellationError(\"promise cancelled\"));\n    }\n  }\n\n  const nextTick = (() => {\n    if (typeof root.Promise === \"function\") {\n      const resolved = Promise.resolve(null);\n      return function queueMicrotaskWithPromise(f, p) {\n        resolved.then(() => f(p));\n      };\n    } else if (typeof root.setImmediate === \"function\") {\n      return root.setImmediate;\n    } else if (typeof root.setTimeout === \"function\") {\n      return (f, p) => root.setTimeout(f, 0, p);\n    } else {\n      // console.error(\"No nextTick. How we gonna do this?\");\n      return (f, p) => f.call(this, p);\n    }\n  })();\n\n  function isCancellationError(v) {\n    return v instanceof CancellationError;\n  }\n\n  function fmtValue (o) {\n    if (isThenable(o)) {\n      return `<PROMISE:${goog.getUid(o)}>`;\n    } else if (o instanceof Error) {\n      return `<EXCEPTION:'${o.message}'>`;\n    } else if (o === null || o === undefined) {\n      return `${o}`;\n    } else if (typeof o === \"function\") {\n      return `<FN:${goog.getUid(o)}>`;\n    } else {\n      return `${o.toString()}`;\n    }\n  }\n\n  function isSome(o) {\n    return o !== null && o !== undefined;\n  }\n\n  function isFunction (o) {\n    return typeof o === \"function\";\n  }\n\n  function isThenable (o) {\n    if (goog.isObject(o)) {\n      const thenFn = o.then;\n      return isFunction(thenFn);\n    } else {\n      return false;\n    }\n  }\n\n  function constantly(v) {\n    return () => v;\n  }\n\n  function identity (v) {\n    return v;\n  }\n\n  function isPromiseImpl (v) {\n    return v instanceof PromiseImpl;\n  }\n\n  function completeDeferredFn(deferred) {\n    return (value, cause) => {\n      if (cause) {\n        deferred.reject(cause);\n      } else {\n        deferred.resolve(value);\n      }\n    };\n  }\n\n  function process(p) {\n    if (p[STATE] === PENDING) return;\n    nextTick(processNextTick, p);\n    return p;\n  }\n\n  function processNextTick(p) {\n    if (p[QUEUE].length === 0) return;\n\n    const state = p[STATE];\n    const value = p[VALUE];\n    let task, rvalue, rcause;\n\n    // console.log(\":: process:\",\n    //             \"uid:\", goog.getUid(p),\n    //             \"queue size:\", p[QUEUE].length,\n    //             \"state:\", p[STATE],\n    //             \"value:\", fmtValue(p[VALUE]));\n\n    while (p[QUEUE].length) {\n      task = p[QUEUE].shift();\n\n      // console.log(\":: process-task:\",\n      //             \"deferred-uid:\", task.deferred ? goog.getUid(task.deferred) : null,\n      //             \"type:\", task.type);\n\n      try {\n        if (state === RESOLVED) {\n          rvalue = task.resolve(value)\n        } else if (state === REJECTED) {\n          rvalue = task.reject(value)\n        } else {\n          rcause = new TypeError(\"invalid state\");\n        }\n      } catch (e) {\n        rcause = e;\n      }\n\n      resolveTask(task, rvalue, rcause);\n    }\n  }\n\n  function resolveTask(task, value, cause) {\n\n    if (task.complete === undefined) return;\n\n    if (cause) {\n      task.complete(null, cause);\n    } else {\n      if (task.type === RESOLVE_TYPE_MAP) {\n        // console.trace(task);\n        task.complete(value, null);\n      } else if (task.type === RESOLVE_TYPE_FLATTEN) {\n        if (isPromiseImpl(value)) {\n          value.handle((v, c) => {\n            resolveTask(task, v, c);\n          });\n        } else if (isThenable(value)) {\n          value.then((v) => {\n            resolveTask(task, v, null);\n          }, (c) => {\n            resolveTask(task, null, c);\n          });\n        } else {\n          task.complete(value, null);\n        }\n      } else if (task.type === RESOLVE_TYPE_BIND) {\n        if (isPromiseImpl(value)) {\n          value.handle((v, c) => {\n            task.complete(v, c);\n          });\n        } else if (isThenable(value)) {\n          value.then((v) => {\n            task.complete(v, null);\n          }, (c) => {\n            task.complete(null, c);\n          });\n        } else {\n          task.complete(null, new TypeError(\"expected thenable\"));\n        }\n      } else {\n        task.complete(null, new TypeError(\"internal: invalid resolve type\"));\n      }\n    }\n  }\n\n  function transition(p, state, value) {\n    // console.log(\">> transition\",\n    //             \"uid:\", goog.getUid(p),\n    //             \"from-state:\", p[STATE],\n    //             \"to-state:\", state,\n    //             \"value:\", fmtValue(value),\n    //             \"queue:\", p[QUEUE].length);\n\n    if (p[STATE] === state ||\n        p[STATE] !== PENDING) {\n      return;\n    }\n\n    p[STATE] = state;\n    p[VALUE] = value;\n\n    return processNextTick(p);\n  }\n\n  self.PromiseImpl = PromiseImpl;\n  self.CancellationError = CancellationError;\n  self.isCancellationError = isCancellationError;\n\n  self.deferred = () => {\n    return new PromiseImpl();\n  };\n\n  const NULL_PROMISE = new PromiseImpl(null);\n\n  self.resolved = function resolved (value) {\n    if (value === null) {\n      return NULL_PROMISE;\n    } else {\n      const p = new PromiseImpl();\n      p[STATE] = RESOLVED;\n      p[VALUE] = value;\n      // console.log(\"++ [resolved]\", \"uid:\", goog.getUid(p), \"value:\", value);\n\n      return p;\n    }\n  };\n\n  self.rejected = function rejected (reason) {\n    const p = new PromiseImpl();\n    p[STATE] = REJECTED;\n    p[VALUE] = reason;\n\n    // console.log(\"++ [rejected]\", \"uid:\", goog.getUid(p), \"value:\", fmtValue(reason));\n\n    return p;\n  };\n\n  self.all = function all (promises) {\n    return promises.reduce((acc, p) => {\n      return acc.then((results) => {\n        return self.coerce(p).fmap((v) => {\n          results.push(v);\n          return results;\n        });\n      });\n    }, self.resolved([]));\n  };\n\n  self.coerce = function coerce (promise) {\n    if (promise instanceof PromiseImpl) {\n      return promise;\n    } else if (isThenable(promise)) {\n      const deferred = self.deferred();\n      promise.then((v) => {\n        deferred.resolve(v);\n      }, (c) => {\n        deferred.reject(c);\n      });\n      return deferred;\n    } else if (promise instanceof Error) {\n      return self.rejected(promise);\n    } else {\n      return self.resolved(promise);\n    }\n  };\n\n  self.race = function race (promises) {\n    const deferred = self.deferred();\n\n    promises.forEach((p) => {\n      self.coerce(p).handle((v, c) => {\n        if (c) {\n          deferred.reject(c);\n        } else {\n          deferred.resolve(v);\n        }\n      });\n    });\n\n    return deferred;\n  };\n\n  self.nextTick = nextTick;\n\n  self.PENDING = PENDING;\n  self.RESOLVED = RESOLVED;\n  self.REJECTED = REJECTED;\n});\n"],
"names":["goog","provide","scope","isCancellationError","v","CancellationError","fmtValue","o","isThenable","getUid","Error","message","undefined","toString","isSome","isFunction","isObject","thenFn","then","constantly","identity","isPromiseImpl","PromiseImpl","completeDeferredFn","deferred","value","cause","reject","resolve","process","p","STATE","PENDING","nextTick","processNextTick","QUEUE","length","state","VALUE","task","rvalue","rcause","shift","RESOLVED","REJECTED","TypeError","e","resolveTask","complete","type","RESOLVE_TYPE_MAP","RESOLVE_TYPE_FLATTEN","handle","c","RESOLVE_TYPE_BIND","transition","self","promesa","impl","promise","root","global","Symbol","defaultResolveMapHandler","defaultResolveBindHandler","resolved","defaultRejectHandler","constructor","val","push","catch","finally","f","fmap","fbind","fn","resolveType","isPending","isResolved","isRejected","isCancelled","cancel","Promise","queueMicrotaskWithPromise","setImmediate","setTimeout","call","self.deferred","NULL_PROMISE","self.resolved","rejected","self.rejected","reason","all","self.all","promises","reduce","acc","results","coerce","self.coerce","race","self.race","forEach"]
}
