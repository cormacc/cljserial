{"version":3,"sources":["stack/services/sync.cljs"],"mappings":";AAYA,sCAAA,tCAAKA;AAEL,AAAKC,iCACH,iBAAAC,WAAA,2CAAA,kDAAA,qEAAA,2DAAA,2DAAA,+FAAA,yDAAA,2CAAA,2DAAA,2CAAA,9OAGWF,oSAEiB,WAAKI,IAAKC;AAAV,AACE,GAAAC;AAAA,AAAA,OAAAC,qDAAA,sBAAA,qDAAA,AAAAC,mBAAA,2CAAA,oEAAA,2CAAA,uDAAA,iDAAA,oDAAA,YAAA,rHACeJ,mDACFC;;AAFb;;GAN9B,gDAAA,2CAAA,oEAAA,wEAAA,wDAAA,2CAAA,sDAU2B,WAAKI,KAAMC;AAAX,AACE,GAAAJ;AAAA,AAAA,OAAAC,qDAAA,sBAAA,qDAAA,AAAAC,mBAAA,2CAAA,kEAAA,mBAAA,oDAAA,YAAA;;AAAA;;GAX7B,gDAAA,2CAAA,sEAAA;AAAA,AAAA,wHAAAN,gDAAAA,hKAACC,yDAAAA,mEAAAA;;AAcH,2BAAA,3BAAMQ;AAAN,AACE,OAACC,yBAAkBX","names":["stack.services.sync/default-context","stack.services.sync/controller","G__61014","statecharts.core/machine","ctx","e","js/goog.debug.LOGGING_ENABLED","lambdaisland.glogi.log","cljs.core/identity","_ctx","_e","stack.services.sync/init","stack.utils.hsm/register"],"sourcesContent":["(ns stack.services.sync\n  \"A database synchronisation service for a local-first application\"\n  (:require\n   [lambdaisland.glogi :as log]\n   [statecharts.core :as hsm]\n   [stack.utils.hsm :as hsm-dbfx]))\n\n;; ============================================================================\n;; Sync service - a statemachine\n;; See https://lucywang000.github.io/clj-statecharts/\n\n;;Initial context...\n(def default-context {})\n\n(def controller\n  (hsm/machine\n   {:id :sync-service\n    :initial :offline\n    :context default-context\n\n    :states {:offline {:entry (fn [ctx, e]\n                                (log/info :offline/entry \"TODO: Start building transaction backlog\"\n                                          :ctx ctx\n                                          :e e))\n                       :on {:auth-sign-in :online}}\n             :online {:entry (fn [_ctx, _e]\n                               (log/info :online/entry \"TODO: Begin sync\"))\n                      :on {:auth-sign-out :offline}}}}))\n\n(defn init []\n  (hsm-dbfx/register controller))\n"]}