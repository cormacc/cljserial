{"version":3,"sources":["stack/utils/uix.cljs"],"mappings":"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","names":["js/stack","js/stack.utils","js/stack.utils.uix","js/stack.utils.uix.uix-root","stack.utils.uix/uix-root","uix.dom.create_root","js/document.getElementById","__run-fn-form","__kind","__ns","__id","__level","sf","taoensso.telemere.impl/*rt-sig-filter*","__inst","js/Date","__thread","__root0","taoensso.telemere.impl/*trace-root*","__otel-context1","__uid","__root1","__run-result","signal__42410__auto__","cljs.core/Delay","signal__42401__auto__","taoensso.telemere.impl/Signal","taoensso.telemere/*ctx*","taoensso.telemere.impl/*trace-parent*","temp__5821__auto__","taoensso.telemere/*middleware*","sig-middleware__42402__auto__","taoensso.telemere.impl/dispatch-signal!","taoensso.telemere.impl/WrappedSignal","cljs-react-devtools.core/init!","stack.utils.uix/render","layout","uix.dom/render-root","stack.utils.uix/use-persistent-state","store-key","initial-value","vec__98735","cljs.core.nth","value","set-value!","uix.core/use-state","uix.hooks.alpha.use_effect","uix.hooks.alpha/use-clj-deps","clojure.edn.read_string","js/localStorage.getItem","G__98740","p1__98734#","cljs.core.into","js/localStorage.setItem","stack.utils.uix/from-hiccup","form","cljs.core/seq?","cljs.core.mapv","cljs.core/vector?","vec__98741","seq__98742","cljs.core/seq","first__98743","cljs.core/first","cljs.core/next","vec__98744","cljs.core._EQ_","cljs.core/rest","tag","attrs","children","cljs.core/map?","cljs.core/count","G__98749","cljs.core/contains?","cljs.core/meta","cljs.core.assoc","cljs.core.map","cljs.core.sequence","cljs.core.concat","cljs.core/List","stack.utils.uix/from-html","html-str","cljs.core.comp","hickory.core/as-hiccup","hickory.core/parse-fragment","stack.utils.uix/replace-last-","s","pattern","replacement","match-pos","clojure.string.last_index_of","prefix","cljs.core.subs","suffix","stack.utils.uix/dedup-parens-","str","clojure.string/starts-with?","clojure.string/replace-first","stack.utils.uix/html->uix","clojure.string/replace"],"sourcesContent":["(ns stack.utils.uix\n  (:require\n   [clojure.edn :as edn]\n   [clojure.string :as s]\n   [taoensso.telemere :as t]\n   [uix.dom]\n   [uix.core :as uix]\n   [cljs-react-devtools.core]\n   ;; FIXME: This import is failing as it's from dev.clj?\n   ;;        Likely blindingly easy to fix if I knew what I was doing...\n   ;; [uix.dev :refer [from-hiccup from-html]]\n   [hickory.core :as h]))\n\n(defonce uix-root\n  (uix.dom/create-root (js/document.getElementById \"app-root\")))\n\n(t/log! :info \"Initialising cljs-react-devtools\")\n(cljs-react-devtools.core/init!\n {:root (js/document.getElementById \"app-root\")\n\n  ;; :shortcut \"Control-Shift-R\"\n  :shortcut \"Control-Shift-Meta-R\"\n  })\n\n(defn render [layout]\n  (uix.dom/render-root layout uix-root))\n\n(defn use-persistent-state\n  \"Loads initial state from local storage and persists every updated state value\n  Returns a tuple of the current state value and an updater function\"\n  [store-key initial-value]\n  (let [[value set-value!] (uix/use-state initial-value)]\n    (uix/use-effect\n      (fn []\n        (let [value (edn/read-string (js/localStorage.getItem store-key))]\n          (set-value! #(into % value))))\n      [store-key])\n    (uix/use-effect\n      (fn []\n        (js/localStorage.setItem store-key (str value)))\n      [value store-key])\n    [value set-value!]))\n\n;;\n;; These two functions are taken new in uix v1.1.0 I.e. written by roman liutikov\n;; Duplicated here because I don't know to import from dev.clj\n(defn from-hiccup [form]\n  (cond\n    (seq? form)\n    (mapv from-hiccup form)\n\n    (vector? form)\n    (let [form (cond\n                 (= :> (first form))\n                 (rest form)\n\n                 :else form)\n          [tag attrs & children] form\n          [attrs children] (cond\n                             (map? attrs) [attrs children]\n                             (> (count form) 1) [nil (into [attrs] children)]\n                             :else [nil children])\n          attrs (cond-> attrs\n                  (contains? (meta form) :key)\n                  (assoc :key (:key (meta form))))\n          children (map from-hiccup children)]\n      (if attrs\n        `(~'$ ~tag ~attrs ~@children)\n        `(~'$ ~tag ~@children)))\n\n    :else form))\n\n(comment\n  (from-hiccup\n   [:div\n    [:div {:class \"foo\"} \"bar\"]\n    [:> 'js-component]\n    [:<> [:button \"hello\"] [:span \"world\"]]\n    ^{:key \"hello\"} [:span \"world\"]]))\n\n(defn from-html\n  \"Converts a HTML string to a clojure form in UIx syntax.\"\n  [html-str]\n  (map (comp from-hiccup h/as-hiccup)\n       (h/parse-fragment html-str)))\n\n(comment\n  (from-html\n   \"<p class=\\\"c-fDhfVa c-fDhfVa-dkirSI-spaced-true c-fDhfVa-jFCKZD-family-default c-fDhfVa-grGuE-size-3 c-fDhfVa-hYBDYy-variant-default c-fDhfVa-kHnRXL-weight-2\\\">Finally, one last scene, just for fun! I ported to React Three Fiber a Three.js demo from <a href=\\\"http://barradeau.com/blog/?p=621\\\" class=\\\"c-iNkjEl c-iNkjEl-dNnDWN-underline-true c-iNkjEl-igJWTOZ-css\\\">an article</a> written by <a href=\\\"https://twitter.com/nicoptere\\\" class=\\\"c-iNkjEl c-iNkjEl-hGYKvZ-discreet-true c-iNkjEl-goIlEV-favicon-true c-iNkjEl-idwngVA-css\\\">@nicoptere</a> that does a pretty good job at deep diving into the FBO technique.</p>\"))\n\n\n;; TODO: Consider moving this to a stringutils module?\n(defn replace-last-\n  \"Replaces last occurrence of pattern with replacement in s.\n  Will probably break given a regex pattern.\"\n  [s pattern replacement]\n  (if-let [match-pos (s/last-index-of s pattern)]\n    (let [prefix (subs s 0 match-pos)\n          suffix (subs s (+ match-pos (count pattern)) (count s))]\n      (str prefix replacement suffix))\n    s))\n\n(defn dedup-parens-\n  \"If the opening and closing parentheses are doubled, undouble them.\n  i.e. '(($ :div))' -> '($ :div).\n  The html->uix conversion below gives doubled opening and closing parentheses - I'm not\n  clever enough to solve this at source, hence clunky workaround.\n  \"\n  [str]\n  (if (s/starts-with? str \"((\")\n    (-> str\n        (s/replace-first \"((\" \"(\")\n        (replace-last- \"((\" \"(\"))\n    str))\n\n(defn html->uix\n  \"Converts a HTML string to a string representation of a clojure form in UIx syntax.\"\n  [html-str]\n  (-> html-str\n      (from-html)\n      (str)\n      (s/replace #\"\\\"(\\\\n\\s*)*\\\"\" \"\\n\")\n      (dedup-parens-)\n;\n      ))\n"]}