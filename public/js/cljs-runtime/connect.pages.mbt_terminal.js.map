{"version":3,"sources":["connect/pages/mbt_terminal.cljs"],"mappings":"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","names":["props__46991__auto__","props98994","uix.core/glue-args","vec__98995","map__98998","cljs.core.nth","cljs.core/--destructure-map","cljs.core.get","f__46992__auto__","js/goog.DEBUG","temp__5823__auto__","connect.pages.mbt-terminal/term-widget-dbfx","f__46909__auto__","*current-component*-orig-val__99001","uix.core/*current-component*","*current-component*-temp-val__99002","cljs.core/map?","js/Error","js/Object.defineProperty","obj99004","js/window","js/window.uix","js/window.uix.dev","sig__46918__auto__","js/window.uix.dev.signature!","js/window.uix.dev.register!","event-sub","tx-event-id","props","events","G__98999","stack.utils.dbfx/use-sub","uix.compiler.alpha/component-element","p1__98992#","stack.uix.term/term-widget","cljs.core/seq","G__99000","stack.utils.dbfx/dispatch","connect.pages.mbt-terminal/port-request-callback","vid","_e","p1__99005#","stack.apis.webserial.await_port","G__99006","G__99007","f__46985__auto__","connect.pages.mbt-terminal/webserial-unsupported-message","*current-component*-orig-val__99009","*current-component*-temp-val__99010","obj99012","uix.compiler.aot/>el","uix.compiler.attributes/interpret-attrs","connect.pages.mbt-terminal/side-panel","*current-component*-orig-val__99019","*current-component*-temp-val__99020","obj99022","port-context","port","port-config","__run-fn-form","__kind","__ns","__id","__level","sf","taoensso.telemere.impl/*rt-sig-filter*","__inst","js/Date","__thread","__root0","taoensso.telemere.impl/*trace-root*","__otel-context1","__uid","__root1","__run-result","signal__42410__auto__","cljs.core/Delay","signal__42401__auto__","taoensso.telemere.impl/Signal","taoensso.telemere/*ctx*","taoensso.telemere.impl/*trace-parent*","temp__5821__auto__","taoensso.telemere/*middleware*","sig-middleware__42402__auto__","taoensso.telemere.impl/dispatch-signal!","taoensso.telemere.impl/WrappedSignal","stack.uix.serial-port/settings","stack.apis.webserial/describe-port","cljs.core.partial","G__99015","k","v","G__99016","cd-info","G__99017","sd-info","uix.compiler.attributes/interpret-props","connect.components.cd-info/card","p1__99013#","stack.uix.file-card/card","G__99018","connect.pages.mbt-terminal/terminal-pane","*current-component*-orig-val__99024","*current-component*-temp-val__99025","obj99027","serial-state","stack.utils.hsm/use-sub-state","stack.utils.hsm/in-state","connect.pages.mbt-terminal/layout","*current-component*-orig-val__99029","*current-component*-temp-val__99030","obj99032"],"sourcesContent":["(ns connect.pages.mbt-terminal\n  (:require\n   [taoensso.telemere :as t]\n   [uix.core :refer [defui $]]\n   [stack.utils.dbfx :as dbfx]\n   [stack.utils.hsm :as hsm-dbfx]\n   [stack.apis.webserial :as wsu]\n   [connect.components.cd-info :as cd-info]\n   [stack.uix.file-card :as file-card]\n   [stack.uix.serial-port :as serial-port]\n   [stack.uix.term :as term]))\n\n\n(defui term-widget-dbfx [{:keys [event-sub tx-event-id] :as props}]\n  (let [events (dbfx/use-sub [event-sub])]\n    ($ term/term-widget {:events events\n                         :on-add-event #(when (seq %)\n                                          (dbfx/dispatch [tx-event-id %]))})))\n\n(defn port-request-callback [vid _e]\n  (wsu/await-port\n   :vendor-id vid\n   :on-success #(dbfx/dispatch [:webserial/has-port %1])\n   :on-failure #(dbfx/dispatch [:webserial/no-port])))\n\n(defui webserial-unsupported-message []\n  ($ :div \"The Web Serial API is not currently available. Make sure you're running Chrome, Edge or Safari and serving this page from a secure context (i.e. over a https link or from localhost).  See Mozilla documentation for more details on \" ($ :a {:href \"https://developer.mozilla.org/en-US/docs/Web/API/Web_Serial_API#browser_compatibility\"} \"browser support\") \", and \" ($ :a {:href \"https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts\"} \"secure contexts\") \".\"))\n\n(defui side-panel []\n  ($ :.flex.flex-col\n     (let [port-context (dbfx/use-sub :webserial)\n           port (:port port-context)\n           port-config (:port-config port-context)]\n       (t/log! :debug port-config)\n       ($ serial-port/settings\n          {:port (if port\n                   (wsu/describe-port port)\n                   nil)\n           :options port-config\n           :on-port-request (partial port-request-callback (:vendorIdFilter port-config))\n           :on-port-forget #(dbfx/dispatch [:webserial/forget-port])\n           :on-option-update (fn [k v]\n                               (dbfx/dispatch [:webserial/option k v]))}))\n     (let [cd-info (dbfx/use-sub [:cd-info])\n           sd-info (:sd_card cd-info)]\n       [($ cd-info/card cd-info)\n        ($ file-card/card {:filestore sd-info :on-file-click #(dbfx/dispatch [:serial-tx (str \"file get \" %)] )})])))\n\n(defui terminal-pane []\n  ($ :.flex.flex-col\n     (let [serial-state (hsm-dbfx/use-sub-state :webserial)]\n       (t/log! :debug (str \"Rendering webserial hsm state \" serial-state))\n       (if (hsm-dbfx/in-state serial-state :no-webserial)\n         ($ webserial-unsupported-message)\n         ($ term-widget-dbfx {:event-sub :serial-events :tx-event-id :serial-tx})))))\n\n(defui layout []\n  ($ :.flex.flex-row.gap-1\n     ($ :.basis-80.grow-0 ($ side-panel))\n     ($ :.basis-0.grow\n        ($ terminal-pane))))\n"]}