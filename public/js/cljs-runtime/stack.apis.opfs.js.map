{"version":3,"sources":["stack/apis/opfs.cljs"],"mappings":"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","names":["stack.apis.opfs/get-root+","js/navigator","var_args","args__5732__auto__","len__5726__auto__","i__5727__auto__","argseq__5733__auto__","cljs.core/IndexedSeq","stack.apis.opfs/get-subdirectory+","p__63192","map__63193","cljs.core/--destructure-map","cljs.core.get","seq63187","G__63188","cljs.core/first","cljs.core/next","G__63189","self__5711__auto__","root+","dir-name","create","promesa.core.chain","promesa.core.promise","p__63071__auto__","cljs.core/clj->js","stack.apis.opfs/get-directory+","p__63203","map__63204","seq63197","G__63198","dir-vector","p1__63195#","p2__63196#","cljs.core.reduce","stack.apis.opfs.get_subdirectory_PLUS_","stack.apis.opfs/create-directory+","dir-path","stack.apis.opfs.get_directory_PLUS_","stack.schema.filestore/get-path-vector","promesa.core.then","dir-handle","__run-fn-form","__kind","__ns","__id","__level","sf","taoensso.telemere.impl/*rt-sig-filter*","__inst","js/Date","__thread","__root0","taoensso.telemere.impl/*trace-root*","__otel-context1","__uid","__root1","__run-result","signal__48019__auto__","cljs.core/Delay","signal__48010__auto__","taoensso.telemere.impl/Signal","taoensso.telemere/*ctx*","taoensso.telemere.impl/*trace-parent*","temp__5821__auto__","taoensso.telemere/*middleware*","sig-middleware__48011__auto__","taoensso.telemere.impl/dispatch-signal!","taoensso.telemere.impl/WrappedSignal","p1__63205#","promesa.core.catch$","stack.apis.opfs/remove-entry+","entry-name","p1__63216#","stack.apis.opfs/get-entries+","result","promesa.core/deferred","promesa.protocols/-mcat","promesa.protocols/-promise","___63008__auto__","folder","folder-name","entry-iter","stack.apis.async-iterator/get-iterator","iter-chan","stack.apis.async-iterator/to-chan","c__33483__auto__","cljs.core.async.chan","cljs.core.async.impl.dispatch/run","f__33484__auto__","switch__33346__auto__","state_63282","state_val_63283","inst_63232","cljs.core/PersistentHashMap","inst_63233","statearr-63289","statearr-63290","cljs.core.async.impl.ioc-helpers/take!","inst_63276","cljs.core.async.impl.ioc-helpers/return-chan","inst_63236","inst_63237","statearr-63295","statearr-63296","statearr-63297","inst_63241","inst_63242","inst_63243","statearr-63304","statearr-63305","inst_63248","inst_63249","inst_63254","cljs.core.nth","inst_63255","inst_63256","inst_63261","inst_63263","inst_63264","inst_63265","inst_63266","inst_63268","cljs.core/PersistentVector","inst_63269","inst_63270","inst_63271","statearr-63313","statearr-63315","inst_63274","statearr-63319","statearr-63320","state-machine__33347__auto__","ret-value__33348__auto__","result__33349__auto__","cljs.core/keyword-identical?","ex__33350__auto__","e63321","statearr-63322","cljs.core/seq","statearr-63323","state__33485__auto__","statearr-63325","cljs.core.async.impl.ioc-helpers/USER-START-IDX","cljs.core.async.impl.ioc-helpers/run-state-machine-wrapped","entry-map","entry","promesa.core.resolve_BANG_","cljs.core/name","cljs.core/assoc-in","stack.apis.opfs/get-file-handle+","p__63336","map__63337","seq63329","G__63330","filepath","fname","stack.schema.filestore/get-filename","fdirs","stack.schema.filestore/get-dir-vector","p1__63328#","stack.apis.opfs/get-file+","stack.apis.opfs/get-file-info","file","stack.apis.opfs/read+","p__63352","map__63353","seq63348","G__63349","as","content","cljs.core._EQ_","finfo","stack.apis.opfs/write+","___62976__auto__","writeable","stack.apis.opfs.get_file_handle_PLUS_","_written","_closed","cljs.core/count","p1__63356#","stack.apis.opfs/delete+","_done"],"sourcesContent":["(ns stack.apis.opfs\n  \"Interface to the Origin Private File System - browser local storage.\n  See https://developer.mozilla.org/en-US/docs/Web/API/File_System_API/Origin_private_file_system\"\n  (:require\n   [cljs.core.async :as async :refer [go-loop <!]]\n   [taoensso.telemere :as t]\n   [promesa.core :as p]\n   [stack.schema.filestore :as fs]\n   [stack.apis.async-iterator :as async-iterator]))\n\n;; N.B. Some of the OPFS api methods use async iterators....\n;; See https://gist.github.com/jjsullivan5196/0904057a2ec3eb080de5c4d6f45da630 for some useful refs on these in cljs\n;; Or an alternative approach... https://ask.clojure.org/index.php/10896/how-to-work-with-asynciterable-interface-in-cljs\n\n(defn get-root+\n  \"Get the root OPFS folder for this app.\"\n  []\n  (.getDirectory (.-storage js/navigator)))\n\n(defn get-subdirectory+\n  \"Get a subdirectory relative to the provided root\"\n  [root+ dir-name & {:keys [create] :or {create false}}]\n  (p/-> root+\n        (.getDirectoryHandle dir-name (clj->js {:create create}))))\n\n(defn get-directory+\n  \"Get a nested subdirectory given an absolute path.\"\n  [dir-vector & {:keys [create] :or {create false}}]\n  ;;To do this, we reduce the vector of directory names to a chain of promises\n  (reduce #(get-subdirectory+ %1 %2 :create create)\n          (get-root+)\n          dir-vector))\n\n(defn create-directory+ [dir-path]\n  (-> (get-directory+ (fs/get-path-vector dir-path) :create true)\n      (p/then (fn [dir-handle]\n                (t/event! ::opfs-create-directory-ok {:data {:directory dir-path}})\n                dir-handle))\n      (p/catch #(t/event! ::opfs-create-directory-error {:level :error :data {:directory dir-path :error %}}))))\n\n(defn remove-entry+\n  \"Delete a file or directory from OPFS.\"\n  [entry-name]\n  (->\n   (p/-> (get-root+)\n         (.removeEntry entry-name));;TODO: Should we delete recursively by default?\n   (p/then #(t/event! ::opfs-delete-ok {:data entry-name}))\n   (p/catch #(t/event! ::opfs-delete-error {:level :error :data {:entry-name entry-name :error %}}))))\n\n(defn get-entries+ []\n  (let [result (p/deferred)]\n    (p/let [folder (get-root+)\n            folder-name (.-name folder)\n            entry-iter (p/-> (.entries folder)\n                             (async-iterator/get-iterator))\n            iter-chan (async-iterator/to-chan entry-iter)]\n      (go-loop [entry-map {}]\n        (let [entry (<! iter-chan)]\n          (if (nil? entry)\n          ;; We're done listing -- handle the result\n            (do\n              (t/event! ::opfs-get-entries-ok {:data entry-map})\n              (p/resolve! result entry-map))\n            (do\n              (t/event! ::opfs-entry {:level :debug :data entry})\n              ;; MAYBE: call getFile on the file handles to extract the size, created and modified metadata\n              ;;       This returns another promise, so a bit fiddly...\n              (let [[entry-name handle] entry\n                    entry-path (str folder-name \"/\" entry-name)\n                    file {:path entry-path :name entry-name :type (name (.-kind handle)) :size 0 :created 0 :modified 0 :bytes \"\"}]\n                (recur (assoc-in entry-map [entry-path] file))))))))\n    result))\n\n(defn get-file-handle+\n  [filepath & {:keys [create] :or {create false}}]\n  (let [fname (fs/get-filename filepath)\n        fdirs (fs/get-dir-vector filepath)]\n    (-> (get-directory+ fdirs :create create)\n        (p/then #(.getFileHandle % fname (clj->js {:create create}))))))\n\n(defn get-file+\n  \"Get a File object from the OPFS.\n  See the following API docs on the File and underlying Blob interfaces:\n  - File :: https://developer.mozilla.org/en-US/docs/Web/API/File\n  - Blob :: https://developer.mozilla.org/en-US/docs/Web/API/Blob\"\n  [filepath]\n  (p/-> (get-file-handle+ filepath)\n    (.getFile)))\n\n(defn- get-file-info [file]\n  {:name (.-name file)\n   :modified (.-lastModified file)\n   :mime-type (.-type file)\n   :size (.-size file)})\n\n(defn read+ [filepath & {:keys [as] :or {as :text}}]\n  (p/let [file (get-file+ filepath)\n          ;;TODO: Consider doing this on the basis of the extracted mime type info rather than an :as argument?\n          content (if (= :text as)\n                    (.text file)\n                    (.arrayBuffer file))]\n    (let [finfo (get-file-info file)]\n      (t/event! ::opfs-read-ok {:data finfo})\n      (-> finfo\n          (assoc-in [:path] filepath)\n          (assoc-in [:data] content)))))\n\n;; TODO: Add replace / overwrite flag?\n(defn write+ [filepath content]\n  (->\n   (p/let [writeable (p/-> (get-file-handle+ filepath :create true)\n                           (.createWritable))\n           _written (.write writeable content)\n           _closed (.close writeable)]\n     (t/event! ::opfs-write-ok {:data filepath})\n     {:path filepath :size (count content)})\n   (p/catch #(t/event! ::opfs-write-error {:level :error :data {:filepath filepath :error %}}))))\n\n(defn delete+ [filepath]\n  (let [fdirs (fs/get-dir-vector filepath)\n        fname (fs/get-filename filepath)]\n    (p/let [_done\n            (p/-> (get-directory+ fdirs)\n                  (.removeEntry fname))]\n          (t/event! ::opfs-delete-ok {:data filepath}))))\n\n\n(comment\n  (write+ \"/bla.bla\" \"blalbalbla\")\n  (delete+ \"/bla.bla\")\n  ;;----\n  )\n"]}