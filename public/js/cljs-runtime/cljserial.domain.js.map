{"version":3,"sources":["cljserial/domain.cljc"],"mappings":";AAQA,8BAAA,9BAAKA;AAIL,0BAAA,1BAAKC;AAEL,wBAAA,mFAAA,mDAAA,mFAAA,kFAAA,mFAAA,oEAAA,mFAAA,0DAAA,2CAAA,kDAAA,4BAAA,mFAAA,qDAAA,x2BAAKC,mSAEGD;AAIR,8BAAA,mFAAA,qDAAA,kDAAA,2DAAA,nRAAKE;AAGL,AAAKC,gCAAa,AAACC,eAAKF;AAExB,4BAAA,mFAAA,mDAAA,mFAAA,wDAAA,mFAAA,wGAAA,mFAAA,6FAAA,mFAAA,wDAAA,mFAAA,mDAAA,mFAAA,kDAAA,4DAAA,mFAAA,yDAAA,4DAAA,mFAAA,qDAAA,17CAAKG,kcAEmBJ,kLACZC;AAWZ,0BAAA,2CAAA,yDAAA,2CAAA,2DAAA,pOAAKI;AAML,mCAAA,nCAAMC,8EAAiBC;AAAvB,AAAA,kDAAA,8EAAA,vBACU,AAACC,gBAAMD,4DACR,AAACC,gBAAM,+CAAA,/CAACC,oGAAaF;;AAE9B,6BAAA,7BAAMG,kEAAWC,YAAYJ;AAA7B,AACE,IAAMK,YAAU,iBAAAC,WAAMF;IAANE,eAAA,EAAA,CAAAA,oBAAAC,oBAAA,AAAAD,aAAA;AAAA,AAAA,QAAAA;KAAA;AACW,4BAAA,rBAACG;;;KADZ;AAAA;;;KAAA;AAGOC;;;;AAHP,MAAA,KAAAF,MAAA,CAAA,mEAAAF;;;;AAAhB,AAIE,OAACJ,+CAAOG,UAAUL;;AAKtB,iCAAA,jCAAMW,0EAAeC;AAArB,AACE,IAAAC,WAAA,AAAA;IAAAC,WAKKF;AALL,AAAA,0GAAAC,SAAAC,yCAAAD,SAAAC,7JAACC,kDAAAA,qEAAAA;;AAUH,4BAAA,5BAAMC,gEAAUC;AAAhB,AAAA,0FAAA,2CAAA,uFAAA,4DAAA,xEACsBA;;AAEtB,sCAAA,tCAAMC,oFAAoBC,QAAQC;AAAlC,AAAA,0FAAA,2CAAA,6DAAA,RACWD,oEAAmBC;;AAE9B,wCAAA,xCAAMC,wFAAsBF,QAAQF;AAApC,AAAA,0FAAA,2CAAA,6DAAA,RACWE,mFAA0BF;;AAErC,+BAAA,/BAAMK,sEAAaH;AAAnB,AAAA,0FAAA,mFAAA,iFACyBA","names":["cljserial.domain/storage-id","cljserial.domain/TaskId","cljserial.domain/Task","cljserial.domain/TaskFilter","cljserial.domain/task-filters","cljs.core/rest","cljserial.domain/TaskView","cljserial.domain/schema","cljserial.domain/get-task-counts","tasks","cljs.core/count","cljs.core.filter","cljserial.domain/filter-by","task-filter","filter-fn","G__63298","cljs.core/Keyword","js/Error","cljs.core/complement","cljs.core/identity","cljserial.domain/extract-tasks","db","G__63299","G__63300","datascript.core/q","cljserial.domain/add-task","description","cljserial.domain/set-task-completed","task-id","done","cljserial.domain/set-task-description","cljserial.domain/delete-task"],"sourcesContent":["(ns cljserial.domain\n  (:require\n   [datascript.core :as d]))\n\n;; -------------------------------------------------------------------------------------\n;; -------------------------------------------------------------------------------------\n;; SCHEMA\n\n(def storage-id \"cljstack\")\n\n;; .... malli\n\n(def TaskId :int)\n\n(def Task\n  [:map\n   [:id TaskId]\n   [:description [:string {:min 1}]]\n   [:done :boolean]])\n\n(def TaskFilter [:enum :all :pending :done])\n\n;;TODO: There's probably a more malli way to do this....\n(def task-filters (rest TaskFilter))\n\n(def TaskView\n  [:map\n   [:tasks [:sequential Task]]\n   [:filter TaskFilter]\n   [:counts [:map\n             [:all :int]\n             [:active :int]\n             [:done :int]]]])\n\n;; ... Datascript\n;; Datascript schema only has to specify items that are unique or collections\n;; See https://cjohansen.no/a-unified-specification/ for a handy intro, and model for a unified ds/malli spec\n;; See https://github.com/kristianmandrup/datascript-tutorial/blob/master/create_schema.md\n\n(def schema\n  {:task/id {:db/unique :db.unique/identity}})\n\n;; -------------------------------------------------------------------------------------\n;; -------------------------------------------------------------------------------------\n;; Utilities\n(defn get-task-counts [tasks]\n  {:total (count tasks)\n   :done (count (filter :done tasks))})\n\n(defn filter-by [task-filter tasks]\n  (let [filter-fn (case task-filter\n                    :pending (complement :done)\n                    :done :done\n                    :all identity)]\n    (filter filter-fn tasks)))\n\n;; -------------------------------------------------------------------------------------\n;; -------------------------------------------------------------------------------------\n;; Queries\n(defn extract-tasks [db]\n  (d/q '[:find ?id ?desc ?done\n         :keys id description done\n         :where\n         [?id :task/description ?desc]\n         [?id :task/done ?done]]\n       db))\n\n;; -------------------------------------------------------------------------------------\n;; -------------------------------------------------------------------------------------\n;; Transactions\n(defn add-task [description]\n  [{:task/description description :task/done false}])\n\n(defn set-task-completed [task-id done]\n  [{:db/id task-id :task/done done}])\n\n(defn set-task-description [task-id description]\n  [{:db/id task-id :task/description description}])\n\n(defn delete-task [task-id]\n  [[:db.fn/retractEntity task-id]])\n"]}