{"version":3,"sources":["zprint/rewrite.cljc"],"mappings":";AAaA,iCAAA,jCAAOA,0EACJC,SAAGC,EAAEC;AADR,AAEE,IAAOC,MAAID;;AAAX,AACE,oBAAI,AAACE,2BAAOD;AACVA;;AACA,oBAAI,CAACH,yCAAAA,8CAAAA,PAAGG,2BAAAA;AACN,IAAAE,qBAAW,CAACJ,kCAAAA,uCAAAA,PAAEE,oBAAAA;AAAd,AAAA,oBAAAE;AAAA,QAAAA,JAASC;AAAT,AACE,eAAO,AAACC,qBAAOD;;;;AACf,eAAO,AAACC,qBAAOJ;;;;;AACjB,eAAO,AAACI,qBAAOJ;;;;;;;;AAEvB,yBAAA,zBAAeK,0DACZN,KAAKF,SAAGC;AADX,AAEE,OAACQ,wBAAUP,KACA,AAACQ,qBAAO,AAACX,+BAAgBC,SACAC,EAEA,iBAAAU,WAAQT;IAARS,eAAA,EAAA,CAAAA,YAAA,OAAA,KAAA,qBAAAA,rBACQC;AADR,AAAA,GAAA,CAAAD,gBAAA;AAAA;;AAAA,mEAAAA,5DAEQE;;;;AAO9C;;;8BAAA,9BAAeC,oEAEZZ;AAFH,AAGE,IAAOa,OAAKb;;AAAZ,AACE,GAAI,uEAAA,vEAACc,6CAAE,AAACC,oBAAMF;AACZ,oDAAK,AAACG,uBAASH,mDACV,iBAAMI,eAAa,AAACC,sBAAQL;AAA5B,AACE,GAAI,+EAAA,/EAACC,6CAAE,AAACC,oBAAME;AAAsB,OAACD,uBAASC;;AAA9C;;;;AACP,eAAO,AAACE,qBAAON;;;;;;;AAErB;;;0BAAA,1BAAeO,4DAEZpB;AAFH,AAGE,IAAMqB,UAAQrB;IACRsB,UAAQ,iBAAOT,OAAKb;UAAZ,NACOuB;;AADP,AAEE,oBAAIV;AAAK,eAAO,AAACK,sBAAQL;eAAM,AAACW,6CAAKD,IAAIV;;;;;AAAOU;;;;;IAE1DE,YAAU,AAACC,gBAAMJ;IACjBK,aAAW,AAACC,gDAAQhB,4BAAaU;AANvC,AASE,IAAOT,OAAKb;IACL6B,UAAQF;eADf,XAEOG;;AAFP,AAQE,oBAAID;AACF,IAAME,QAAM,AAACC,gBAAMH;IAGbI,WAAS,EAAI,wEAAA,xEAACnB,6CAAE,AAACC,oBAAMgB,kEACZ,AAACG,gCAAe,AAAClB,uBAASe,QAC1B,AAACrB,qBAAOqB;IAGnBI,eACsB,AAACC,oBAAoBvB,KAAKoB;AATtD,AAYE,eAAO,AAACf,sBAAQiB;eAAc,AAACE,eAAKR;eAASM;;;;;;AAC/C,OAACG,mBAAKR;;;;;AAEd;;;2BAAA,3BAAeS,8DAEZvC;AAFH,AAGE,OAACoB,wBAAS,AAACD,qBAAO,AAACD,sBAAQlB;;AAE7B;;;mCAAA,nCAAMwC,8EAEHC,OAAOC,QAAQ1C;AAFlB,AAGE,IAAM2C,UAAQ,4BAAA,WAAAC,vCAACtC,uBAAQN;AAAT,AACU,SAAK,mFAAA,nFAACc,6CAAE,oBAAA8B,pBAAC7B,oGACJ,qFAAA,rFAACD,6CAAE,sBAAA8B,tBAACC;GACVN;AAHvB,AAIEI","names":["zprint.rewrite/prewalk-subtree","p?","f","zloc","loc","rewrite-clj.zip/end?","temp__5821__auto__","n","rewrite-clj.zip/next","zprint.rewrite/prewalk","rewrite-clj.zip/replace","rewrite-clj.zip/root","G__72930","rewrite-clj.zip/node","rewrite_clj.zip.of_node_STAR_","zprint.rewrite/get-sortable","nloc","cljs.core._EQ_","rewrite-clj.zip/tag","rewrite-clj.zip/string","next-element","rewrite-clj.zip/right","rewrite-clj.zip/down","zprint.rewrite/sort-val","dep-val","dep-seq","out","cljs.core.conj","dep-count","cljs.core/count","sorted-seq","cljs.core.sort_by","new-loc","last-loc","new-z","cljs.core/first","new-node","rewrite-clj.parser/parse-string","replaced-loc","clojure.zip/replace","cljs.core/next","rewrite-clj.zip/up","zprint.rewrite/sort-down","zprint.rewrite/sort-dependencies","caller","options","new-dep","p1__72982#","rewrite-clj.zip/sexpr"],"sourcesContent":["(ns zprint.rewrite\n  (:require clojure.string\n            [zprint.zutil :as zu :refer [zreplace]]\n            [rewrite-clj.parser :as p]\n            [rewrite-clj.node :as n]\n            [rewrite-clj.zip :as z :refer [string tag sexpr of-node*]]))\n\n;;\n;; No prewalk in rewrite-cljs, so we'll do it ourselves here\n;; for both environments, so that we can lean on the clj testing\n;; for cljs.\n;;\n\n(defn- prewalk-subtree\n  [p? f zloc]\n  (loop [loc zloc]\n    (if (z/end? loc)\n      loc\n      (if (p? loc)\n        (if-let [n (f loc)]\n          (recur (z/next n))\n          (recur (z/next loc)))\n        (recur (z/next loc))))))\n\n(defn ^:no-doc prewalk\n  [zloc p? f]\n  (z/replace zloc\n             (z/root (prewalk-subtree p?\n                                      f\n                                      ; Make a zipper whose root is zloc\n                                      (some-> zloc\n                                              z/node\n                                              of-node*)))))\n\n\n;;\n;; # Routines to modify zippers inside of zprint\n;;\n\n(defn ^:no-doc get-sortable\n  \"Given a zloc, get something out of it that is sortable.\"\n  [zloc]\n  (loop [nloc zloc]\n    (if (= (z/tag nloc) :token)\n      (str (z/string nloc)\n           (let [next-element (z/right nloc)]\n             (if (= (z/tag next-element) :token) (z/string next-element) \"\")))\n      (recur (z/down nloc)))))\n\n(defn ^:no-doc sort-val\n  \"Sort the everything in the vector to the right of zloc.\"\n  [zloc]\n  (let [dep-val zloc\n        dep-seq (loop [nloc zloc\n                       out []]\n                  (if nloc (recur (z/right nloc) (conj out nloc)) out))\n        #_(println \"sort-val: count:\" (count dep-seq))\n        dep-count (count dep-seq)\n        sorted-seq (sort-by get-sortable dep-seq)\n        #_(println \"sort-val: dep-seq:\" (mapv get-sortable dep-seq))\n        #_(println \"sort-val: sorted-seq:\" (mapv get-sortable sorted-seq))]\n    (loop [nloc zloc\n           new-loc sorted-seq\n           last-loc nil]\n      #_(println \"sort-val: loop: before:\" (z/string nloc))\n      #_(when nloc (println \"sort-val: loop: n/tag:\" (n/tag (z/node nloc))))\n      #_(when new-loc\n          (println \"sort-val: loop: after:\" (n/string (z/node (first new-loc))))\n          (println \"sort-val: loop: n/tag:\" (n/tag (z/node (first new-loc)))))\n      (if new-loc\n        (let [new-z (first new-loc)\n              ; rewrite-cljs doesn't handle z/node for :uneval\n              ; so we will get an :uneval node a different way\n              new-node (if (= (z/tag new-z) :uneval)\n                         (p/parse-string (z/string new-z))\n                         (z/node new-z))\n              ; use clojure.zip for cljs, since the z/replace has\n              ; a built-in coerce, which doesn't work for an :uneval\n              replaced-loc #?(:clj (z/replace nloc new-node)\n                              :cljs (clojure.zip/replace nloc new-node))]\n          #_(println \"sort-val: loop: replaced-loc n/tag:\"\n                     (n/tag (z/node replaced-loc)))\n          (recur (z/right replaced-loc) (next new-loc) replaced-loc))\n        (z/up last-loc)))))\n\n(defn ^:no-doc sort-down\n  \"Do a down and a sort-val\"\n  [zloc]\n  (sort-val (z/down (z/right zloc))))\n\n(defn sort-dependencies\n  \"Reorder the dependencies in a project.clj file.\"\n  [caller options zloc]\n  (let [new-dep (prewalk zloc\n                         #(and (= (z/tag %1) :token)\n                               (= (z/sexpr %1) :dependencies))\n                         sort-down)]\n    new-dep))\n"],"x_google_ignoreList":[0]}